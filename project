
CREATE TABLE users (
    id_user INT(12) PRIMARY KEY AUTO_INCREMENT NOT NULL,
    name VARCHAR(60),
    last_name VARCHAR(60),
    mail VARCHAR(100),
    phone_number VARCHAR(30),
    password_ VARCHAR(64),
    registration_date DATETIME
);

CREATE TABLE basket(
    id_basket int(12) PRIMARY KEY NOT NULL,
FOREIGN KEY(id_basket) REFERENCES users(id_user) ON DELETE CASCADE);

CREATE TABLE baking_method(
    id_baking_method int(12) AUTO_INCREMENT NOT NULL PRIMARY KEY,
    type varchar(30)
);

CREATE TABLE flavours(
    id_flavour int(12) AUTO_INCREMENT NOT NULL PRIMARY KEY,
    flavour varchar(40)
    );
    
CREATE TABLE products(
    id_product int(12) AUTO_INCREMENT NOT NULL PRIMARY KEY,
    product_name varchar(100),
    description TEXT,
    price decimal(10,2),
    id_baking_method int(12),
    quantity_in_stock int(15),
FOREIGN KEY(id_baking_method) REFERENCES baking_method(id_baking_method)
);

CREATE TABLE flavour_product(
    id_flavour_product int(12) AUTO_INCREMENT NOT NULL PRIMARY KEY,
    id_product int(12),
    id_flavour int(12),
FOREIGN KEY(id_product) REFERENCES products(id_product),
FOREIGN KEY(id_flavour) REFERENCES flavours(id_flavour));

CREATE TABLE basket_items(
    id_basket_item int(12) AUTO_INCREMENT NOT NULL,
    id_basket int(12),
    id_product int(12),
    quantity int(10) DEFAULT 1,
FOREIGN KEY(id_product) REFERENCES products(id_product),
FOREIGN KEY (id_basket) REFERENCES basket(id_basket)
);

CREATE TABLE allergens(
    id_allergen int(12) AUTO_INCREMENT NOT NULL PRIMARY KEY,
    allergen varchar(50));
    
CREATE TABLE allergen_product(
    id_allergen_product int(12) AUTO_INCREMENT NOT NULL PRIMARY KEY,
    id_product int(12),
    id_allergen int(12),
FOREIGN KEY(id_product) REFERENCES products(id_product),
FOREIGN KEY(id_allergen) REFERENCES allergens(id_allergen));
    
CREATE TABLE order_status(
    id_status int(12) AUTO_INCREMENT NOT NULL PRIMARY KEY,
    o_status varchar(20));
    
CREATE TABLE orders(
    id_order int(12) AUTO_INCREMENT NOT NULL PRIMARY KEY,
    id_user int(12),
    order_date datetime,
    total_price decimal(10,2),
    o_status int(12), 
FOREIGN KEY(id_user) REFERENCES users(id_user),
FOREIGN KEY(o_status) REFERENCES order_status(id_status)
);

CREATE TABLE order_items(
    id_order_item int(12) AUTO_INCREMENT NOT NULL PRIMARY KEY,
    id_order int(12),
    id_product int(12),
    quantity int(10),
    total_products_price int(15),
FOREIGN KEY(id_order) REFERENCES orders(id_order),
FOREIGN KEY(id_product) REFERENCES products(id_product));
    
CREATE TABLE address(
    id_address int(12) AUTO_INCREMENT NOT NULL PRIMARY KEY,
    id_order int(12),
    street varchar(100),
    city varchar(50),
    psc varchar(10),
    country varchar(30),
FOREIGN KEY(id_order) REFERENCES orders(id_order));

CREATE TABLE payment_metod(
    id_metod int(12) AUTO_INCREMENT NOT NULL PRIMARY KEY,
    metod varchar(20));
    
CREATE TABLE payments(
    id_payment int(12) AUTO_INCREMENT NOT NULL PRIMARY KEY,
    id_order int(12),
    id_pay_metod int(12),
    ammount int(10,2),
    date_of_payment datetime,
FOREIGN KEY(id_order) REFERENCES orders(id_order),
FOREIGN KEY(id_pay_metod) REFERENCES payment_metod(id_metod));

CREATE TABLE reviews(
    id_review int(12) AUTO_INCREMENT NOT NULL PRIMARY KEY,
    id_user int(12),
    id_order int(12),
    rating int(3),
    review_text text,
    review_date datetime),
FOREIGN KEY(id_user) REFERENCES users(id_user),
FOREIGN KEY(id_order) REFERENCES orders(id_order));
